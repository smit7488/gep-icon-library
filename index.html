<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEP Icon Guide</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        @font-face {
            font-family: "Azo Sans Regular";
            src: url('https://assets.henryschein.com/AzoSans-Regular.woff2') format("woff2");
            font-display: block;
        }

        @font-face {
            font-family: "Azo Sans Bold";
            src: url('https://assets.henryschein.com/AzoSans-Bold.woff2') format("woff2");
            font-display: block;
        }
    </style>
    <link rel="stylesheet"
        href="https://www.henryschein.com/dist/HSUSGEPAngularJSS/browser/styles.6249c727cf0dfab50d61.css">
    <style>
        * {
            box-sizing: border-box;
        }

        code span {
            font-family: inherit !important;}

        body {
            font-family: 'Azo Sans Regular',-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 40px;
            background: #f4f4f9;
            color: #333;
            margin: 0;
        }

        .header {
            background: #002F6E;
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header h1 {
            margin: 0 0 10px 0;
        }

        .header p {
            margin: 5px 0;
            opacity: 0.9;
        }

        .header code {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .controls label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #002F6E;
        }

        .controls input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .controls button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #0072BC;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .controls button:hover {
            background: #005a96;
        }

        .error {
            background: #FEE9EA;
            color: #ED1C24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #eee;
        }
        .type-badge {
         
   color: #0072bc;
    background: #eee;
    display: inline-block;
    padding: 1px 6px;
    border-radius: 4px;
    font-size: 11px;
    margin-bottom: 1rem;
        }

        .type-badge.pictograph { background: #831A5B; color: #fff; }
        .type-badge.wireblock { background: #008996; color: #fff; }
        .type-badge.background { background: #F28B00; color: #fff; }

        /* Skeleton Loading Animation */
        @keyframes pulse {
            0% {
                background-color: #eee;
            }

            50% {
                background-color: #f5f5f5;
            }

            100% {
                background-color: #eee;
            }
        }

        .card.is-loading .label,
        .card.is-loading .preview-area,
        .card.is-loading select,
        .card.is-loading .button-group,
        .card.is-loading .code-block {
            background: #eee;
            animation: pulse 1.5s infinite ease-in-out;
            border: none;
            color: transparent !important;
        }

        .card.is-loading code {
            display: none;
        }

        .card.is-loading svg {
            display: none;
        }

        .preview-area {
            height: 120px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 10px;
        }

        .preview-area svg {

            width: auto;
            height: auto;
            max-width: 110px;
            max-height: 100%;

            vector-effect: non-scaling-stroke;

            display: block;
            margin: auto;
        }

        .label {
            font-weight: bold;
          margin-bottom: .5rem;
            color: #002F6E;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        select {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
            font-size: 13px;
            cursor: pointer;
         
        }

        input.filter-input {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background: white;
            font-size: 13px;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .download-btn {
            flex: 1;
            padding: 8px 5px;
            /* Less horizontal padding to fit two buttons */
            font-size: 11px;
            /* Slightly smaller font for the buttons */
            background: #0072bc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .download-btn:hover {
            background: #0060A0;
        }


        .code-block {
            position: relative;
            margin-top: 15px;
            min-height: 60px;
        }

        code {
            display: block;
            background: #1e1e1e !important;
            /* color: #d4d4d4; */
            padding: 12px;
            font-size: 11px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: ui-monospace, 
                 'Cascadia Code', 
                 'Source Code Pro', 
                 Menlo, 
                 Monaco, 
                 'Consolas', 
                 'DejaVu Sans Mono', 
                 monospace;
            line-height: 1.4;
            word-wrap: break-word;
        }
     

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #0072BC;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 10px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 10;
        }

        .copy-btn:hover {
            background: #005a96;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6B6F70;
        }

        /* Scrollbar styling for the master CSS block */
        #master-css-code::-webkit-scrollbar {
            width: 6px;
        }

        #master-css-code::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        #master-css-code::-webkit-scrollbar-thumb {
            background: #0072BC;
            border-radius: 3px;
        }

        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            align-items: center;
            background: #eef2f7;
            padding: 15px;
            border-radius: 8px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            font-size: 11px;
            text-transform: uppercase;
            color: #002F6E;
            margin-bottom: 4px;
            font-weight: bold;
        }

        .filter-bar select {
            margin-bottom: 0;
            /* Override default select margin */
        }

.png-download-container select {
    background: #fff;
    border: 1px solid #ccc;
    font-size: 11px;
 
}

/* Full-width container for Backgrounds */
.full-width-section {
    width: 100%;
    margin-bottom: 50px;
}

.section-header {
    width: 100%;
    font-family: "Azo Sans Bold", sans-serif;
    font-size: 24px;
    color: #002F6E;
    margin: 40px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #0072BC;
}

/* Wide card style for Backgrounds */
.card-wide {
    background: white;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.preview-area-wide {
    height: 400px; /* Much taller for full backgrounds */
    width: 100%;
    background-color: #0072BC;
    border-radius: 8px;
    /* Mask properties remain dynamic in JS */
}



        /* ==========================================================================
   GEP ICON SYSTEM - Master CSS
   ========================================================================== */

.icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    fill: currentColor;   
    stroke: currentColor;
    vertical-align: middle;
    transition: color 0.2s ease; 
}

.icon-sm { width: 16px; height: 16px; }
.icon-md { width: 32px; height: 32px; }
.icon-lg { width: 48px; height: 48px; }

/* DARK BLUE */
.icon-dark-blue    { color: #002F6E; }
.icon-dark-blue-t4 { color: #8098B7; }
.icon-dark-blue-t3 { color: #B3C1D4; }
.icon-dark-blue-t2 { color: #E6EBF1; }
.icon-dark-blue-t1 { color: #F5F7F9; }

/* BLUE - Primary Corporate */
.icon-blue         { color: #0072BC; }
.icon-blue-t4      { color: #80B9DE; }
.icon-blue-t3      { color: #B3D5EB; }
.icon-blue-t2      { color: #E6F1F9; }
.icon-blue-t1      { color: #F5F9FC; }

/* LIGHT BLUE */
.icon-light-blue    { color: #3DB5E6; }
.icon-light-blue-t4 { color: #9FDBF3; }
.icon-light-blue-t3 { color: #C5E9F8; }
.icon-light-blue-t2 { color: #ECF8FD; }
.icon-light-blue-t1 { color: #F7FCFE; }

/* GREEN */
.icon-green         { color: #008996; }
.icon-green-t4      { color: #80C5CB; }
.icon-green-t3      { color: #B3DCE0; }
.icon-green-t2      { color: #E6F4F5; }
.icon-green-t1      { color: #F5FAFB; }

/* RED */
.icon-red    { color: #ED1C24; }
.icon-red-t4 { color: #F7BE92; }
.icon-red-t3 { color: #FABBB0; }
.icon-red-t2 { color: #FEE9EA; }
.icon-red-t1 { color: #FFF6F6; }

/* VIOLET */
.icon-violet    { color: #831A5B; }
.icon-violet-t4 { color: #C2BDAE; }
.icon-violet-t3 { color: #DABACE; }
.icon-violet-t2 { color: #F3E9EF; }
.icon-violet-t1 { color: #FAF6F8; }

/* ORANGE */
.icon-orange    { color: #F28B00; }
.icon-orange-t1 { color: #FFFAF5; }
.icon-orange-t2 { color: #FEF4E6; }
.icon-orange-t3 { color: #FBDCB3; }
.icon-orange-t4 { color: #F9C680; }

/* GRAYSCALE */
.icon-dark-gray    { color: #474F50; }
.icon-gray         { color: #6B6F70; }
.icon-light-gray-1 { color: #F7F7F6; }
.icon-light-gray-2 { color: #E6E6E6; }
.icon-black        { color: #000000; }
.icon-white        { color: #FFFFFF; }

/* Smooth scrolling for the whole page */
html {
  scroll-behavior: smooth;
}

.back-to-top {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 45px;
  height: 45px;
  background-color: #0072BC; /* Your brand blue */
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.3s, transform 0.3s;
  opacity: 0; /* Hidden by default */
  pointer-events: none;
  z-index: 1000;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.back-to-top.show {
  opacity: 1;
  pointer-events: auto;
}

.back-to-top:hover {
  background-color: #005a96;
  transform: translateY(-3px);
}

/* Using the Mask Method for the arrow icon */
.icon-arrow {
  width: 20px;
  height: 20px;
  background-color: white; /* Color of the arrow */
  -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 4l-8 8h5v8h6v-8h5z'/%3E%3C/svg%3E") no-repeat center;
  mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 4l-8 8h5v8h6v-8h5z'/%3E%3C/svg%3E") no-repeat center;
  mask-size: contain;
}




    </style>
</head>

<body>
    <div class="header">
        <div class="container-lg" style="max-width: 1400px">
        <div class="row g-3 pt-2 mt-3 mb-5">
            <div class="col-12 col-sm-6 p-2 d-flex flex-column justify-content-center" style="z-index: 1">
                <h1>GEP Icon Guide &amp; Generator</h1>
                <p id="sprite-info">Loading sprite information...</p>
            </div>

            <div class="col-12 col-sm-6 p-2">
                <svg class="icon icon-blue" style="
    width: 700px;
    height: 700px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 0;
    opacity: 0.6;
">
  <use href="./dist/hs-icons-master.svg#Business_Administration"></use>
</svg>
                   <label
                        style="font-size: 11px; text-transform: uppercase; color: #fff; margin-bottom: 5px; display: block; opacity: 0.8;">
                        Master System CSS
                    </label>
                <div class="code-block" style="margin-top: 0;">
                 
                    <button class="copy-btn" onclick="copyToClipboard('master-css-code', this)">Copy CSS</button>
                    <code id="master-css-code" style="max-height: 180px; overflow-y: auto;">/* ==========================================================================
   GEP ICON SYSTEM - Master CSS
   ========================================================================== */

.icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    fill: currentColor;   
    stroke: currentColor;
    vertical-align: middle;
    transition: color 0.2s ease; 
}

.icon-sm { width: 16px; height: 16px; }
.icon-md { width: 32px; height: 32px; }
.icon-lg { width: 48px; height: 48px; }

/* DARK BLUE */
.icon-dark-blue    { color: #002F6E; }
.icon-dark-blue-t4 { color: #8098B7; }
.icon-dark-blue-t3 { color: #B3C1D4; }
.icon-dark-blue-t2 { color: #E6EBF1; }
.icon-dark-blue-t1 { color: #F5F7F9; }

/* BLUE - Primary Corporate */
.icon-blue         { color: #0072BC; }
.icon-blue-t4      { color: #80B9DE; }
.icon-blue-t3      { color: #B3D5EB; }
.icon-blue-t2      { color: #E6F1F9; }
.icon-blue-t1      { color: #F5F9FC; }

/* LIGHT BLUE */
.icon-light-blue    { color: #3DB5E6; }
.icon-light-blue-t4 { color: #9FDBF3; }
.icon-light-blue-t3 { color: #C5E9F8; }
.icon-light-blue-t2 { color: #ECF8FD; }
.icon-light-blue-t1 { color: #F7FCFE; }

/* GREEN */
.icon-green         { color: #008996; }
.icon-green-t4      { color: #80C5CB; }
.icon-green-t3      { color: #B3DCE0; }
.icon-green-t2      { color: #E6F4F5; }
.icon-green-t1      { color: #F5FAFB; }

/* RED */
.icon-red    { color: #ED1C24; }
.icon-red-t4 { color: #F7BE92; }
.icon-red-t3 { color: #FABBB0; }
.icon-red-t2 { color: #FEE9EA; }
.icon-red-t1 { color: #FFF6F6; }

/* VIOLET */
.icon-violet    { color: #831A5B; }
.icon-violet-t4 { color: #C2BDAE; }
.icon-violet-t3 { color: #DABACE; }
.icon-violet-t2 { color: #F3E9EF; }
.icon-violet-t1 { color: #FAF6F8; }

/* ORANGE */
.icon-orange    { color: #F28B00; }
.icon-orange-t1 { color: #FFFAF5; }
.icon-orange-t2 { color: #FEF4E6; }
.icon-orange-t3 { color: #FBDCB3; }
.icon-orange-t4 { color: #F9C680; }

/* GRAYSCALE */
.icon-dark-gray    { color: #474F50; }
.icon-gray         { color: #6B6F70; }
.icon-light-gray-1 { color: #F7F7F6; }
.icon-light-gray-2 { color: #E6E6E6; }
.icon-black        { color: #000000; }
.icon-white        { color: #FFFFFF; }</code>
                </div>
            </div>
        </div>
    </div></div>

    <div class="controls" hidden>
        <label for="config-file">Config File (relative to this HTML file):</label>
        <input type="text" id="config-file" value="./dist/hs-icons-master-config.json"
            placeholder="e.g., hs-icons-master-config.json">
        <button onclick="loadConfig()">Load Sprite</button>
    </div>

    <div id="error-container"></div>
    <div id="sprite-container" style="display: none;"></div>
    <div id="filter-container" class="filter-bar" style="display: none;">
        <div class="filter-group">
            <label>Search Icons</label>
            <input class="filter-input" type="text" id="search-input" placeholder="Search by name..."
                oninput="filterIcons()">
        </div>
        <div class="filter-group">
            <label>Type</label>
            <select id="type-filter" onchange="filterIcons()">
                <option value="all">All Types</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Category</label>
            <select id="category-filter" onchange="filterIcons()">
                <option value="all">All Categories</option>
            </select>
        </div>
    </div>
    <div id="background-section" class="full-width-section" style="display: none;">
    <h2 class="section-header">Background Patterns (Full Width)</h2>
    <div id="background-list"></div>
</div>

    <div id="grid" class="grid"></div>
    <button id="backToTop" class="back-to-top" title="Go to top">
  <span class="icon-arrow"></span>
</button>

    <script>
    let currentConfig = null;
    let spriteText = '';
    let observer = null;
    let debounceTimer;

    // 1. CALCULATE DYNAMIC BASE PATH
    const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);

    function formatColorLabel(cls) {
    // Remove 'icon-' prefix
    let label = cls.replace('icon-', '');
    
    // Handle tint variations (t1, t2, t3, t4)
    const tintMatch = label.match(/-t(\d)$/);
    if (tintMatch) {
        label = label.replace(/-t\d$/, '');
        const tintNumber = tintMatch[1];
        
        // Capitalize each word
        label = label.split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
        ).join(' ');
        
        return `${label} Tint ${tintNumber}`;
    }
    
    // For non-tint colors, just capitalize
    return label.split('-').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ');
}


    // --- SYSTEM LOGIC ---
    async function loadConfig() {
        const configFile = document.getElementById('config-file').value;
        try {
            const response = await fetch(configFile);
            currentConfig = await response.json();

            if (currentConfig.spriteUrl.startsWith('.')) {
                currentConfig.spriteUrl = currentConfig.spriteUrl.replace(/^\./, baseUrl).replace(/\/+/g, '/').replace(':/', '://');
            }
            if (currentConfig.spriteFile.startsWith('.')) {
                currentConfig.spriteFile = currentConfig.spriteFile.replace(/^\./, baseUrl).replace(/\/+/g, '/').replace(':/', '://');
            }
            
            document.getElementById('sprite-info').innerHTML = `
              
                Sprite URL: <a href="${currentConfig.spriteUrl}">${currentConfig.spriteUrl}</a>
            `;

            await loadSprite();
            setupFilters();
            renderIcons();

            const masterCss = document.getElementById('master-css-code');
            if (masterCss) {
    masterCss.className = 'language-css';
    hljs.highlightElement(masterCss);
}
            
        } catch (e) { console.error("Config load failed", e); }
    }

    async function loadSprite() {
        const response = await fetch(currentConfig.spriteFile);
        spriteText = await response.text();
        document.getElementById('sprite-container').innerHTML = spriteText;
    }

    function setupFilters() {
        const types = new Set();
        const categories = new Set();
        currentConfig.icons.forEach(i => { if(i.type) types.add(i.type); if(i.category) categories.add(i.category); });
        const tSel = document.getElementById('type-filter');
        const cSel = document.getElementById('category-filter');
        types.forEach(t => {
  const cap = t.charAt(0).toUpperCase() + t.slice(1);
  tSel.innerHTML += `<option value="${t}">${cap}</option>`;
});

        categories.forEach(c => cSel.innerHTML += `<option value="${c}">${c}</option>`);
        document.getElementById('filter-container').style.display = 'flex';
    }

    function filterIcons() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            const q = document.getElementById('search-input').value.toLowerCase();
            const t = document.getElementById('type-filter').value;
            const c = document.getElementById('category-filter').value;
            const filtered = currentConfig.icons.filter(i => 
                i.id.toLowerCase().includes(q) && (t === 'all' || i.type === t) && (c === 'all' || i.category === c)
            );
            renderIcons(filtered);
        }, 250);
    }

    function renderIcons(icons = currentConfig.icons) {
    const grid = document.getElementById('grid');
    const bgSection = document.getElementById('background-section');
    const bgList = document.getElementById('background-list');
    
    grid.innerHTML = '';
    bgList.innerHTML = '';
    bgSection.style.display = 'none';

    icons.forEach(i => {
        const card = document.createElement('div');
        const safeId = i.id.replace(/[^a-zA-Z0-9-_]/g, '_');
        card.dataset.id = i.id;
        card.id = `card-${safeId}`;

        if (i.type === 'background') {
            bgSection.style.display = 'block';
            card.className = 'card-wide is-loading';
            bgList.appendChild(card);
        } else {
            card.className = 'card is-loading';
            grid.appendChild(card);
        }

        // Standard placeholder
        card.innerHTML = `<div class="preview-area"></div>`;
        
        // Re-run the actual content loader immediately or via observer
        loadActualContent(card, i);
    });
}

function loadActualContent(card, item) {
    const safeId = item.id.replace(/[^a-zA-Z0-9-_]/g, '_');
    const isMask = item.type === 'background';
    const typeClass = item.type ? item.type.toLowerCase() : 'general';
    const typeDisplay = item.type ? item.type.charAt(0).toUpperCase() + item.type.slice(1) : 'General';
    
    if (isMask) {
        card.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;">
                <div>
                    <span class="label" style="font-size: 1.2rem;">${item.id}</span>
                    <div class="type-badge background">Background Wireblock</div>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div style="width: 200px;">
                        <label style="font-size: 11px; font-weight: bold; color: #002F6E;">WIREBLOCK COLOR</label>
                        <select onchange="const [cls, hex] = this.value.split('|'); updateMask('${item.id}', cls, hex, '${item.path}');">
                            ${buildColorOptions()}
                        </select>
                    </div>
                    <div style="width: 200px;">
                        <label style="font-size: 11px; font-weight: bold; color: #002F6E;">PREVIEW BG COLOR</label>
                        <select onchange="updateMaskBackground('${safeId}', this.value);">
                            ${buildColorOptions('icon-white')}
                        </select>
                    </div>
                </div>
            </div>

            <div id="preview-wrapper-${safeId}" style="background-color: #FFFFFF; border-radius: 8px; padding: 0;">
                <div class="preview-area-wide" id="preview-${safeId}" 
                     style="-webkit-mask: url('${item.path}') no-repeat center; 
                            mask: url('${item.path}') no-repeat center; 
                            mask-size: cover; 
                            -webkit-mask-size: cover; 
                            background-color: #0072BC;">
                </div>
            </div>
            
            <div class="code-block">
                <button class="copy-btn" onclick="copyToClipboard('code-${safeId}', this)">Copy CSS</button>
                <code id="code-${safeId}"></code>
            </div>
            <button class="download-btn" style="max-width: 200px;" onclick="downloadMaskSVG('${item.id}', '${item.path}')">Download Source SVG</button>
        `;
        card.classList.remove('is-loading');
        updateMask(item.id, 'icon-blue', '#0072BC', item.path);
    }
    else {
        // Render regular icon card
        card.innerHTML = `
            <span class="label">${item.id}</span>
            <div class="type-badge-wrapper"><div class="type-badge ${typeClass}">${typeDisplay}</div></div>
            <div class="preview-area" id="preview-${safeId}" style="color: #0072BC;">
                <svg><use href="${currentConfig.spriteUrl}#${item.id}"></use></svg>
            </div>
            
            <select data-safe-id="${safeId}" onchange="const [cls, hex] = this.value.split('|'); updateIcon('${item.id}', cls, hex);">
                ${buildColorOptions()}
            </select>

            <div class="button-group" style="display: flex; gap: 4px; margin-top: 10px;">
                <button class="download-btn" onclick="downloadSVG('${item.id}', '${safeId}')">SVG</button>
                
                <div class="png-download-container" style="display: flex; flex: 1;">
                    <select id="size-${safeId}" style="border-radius: 4px 0 0 4px; border-right: none; padding: 4px; flex: 1;">
                        <option value="1024">1024</option>
                        <option value="512" selected>512</option>
                        <option value="256">256</option>
                        <option value="128">128</option>
                        <option value="64">64</option>
                    </select>
                    <button class="download-btn" 
                            style="background:#474F50; border-radius: 0 4px 4px 0; padding: 4px 8px; flex: 1;" 
                            onclick="downloadPNG('${item.id}', '${safeId}')">
                        PNG
                    </button>
                </div>
            </div>

            <div class="code-block">
                <button class="copy-btn" onclick="copyToClipboard('code-${safeId}', this)">Copy</button>
                <code id="code-${safeId}"></code>
            </div>
        `;
        card.classList.remove('is-loading');
        updateIcon(item.id, 'icon-blue', '#0072BC');
    }
}

// Update buildColorOptions to accept a default selection parameter
function buildColorOptions(defaultSelection = 'icon-blue') {
    let html = '';
    for (const [group, colors] of Object.entries(currentConfig.colors)) {
        html += `<optgroup label="${group}">`;
        for (const [cls, hex] of Object.entries(colors)) {
            const displayLabel = formatColorLabel(cls);
            const isSelected = cls === defaultSelection ? 'selected' : '';
            html += `<option value="${cls}|${hex}" ${isSelected}>${displayLabel}</option>`;
        }
        html += '</optgroup>';
    }
    return html;
}

// Add this new function to update the background wrapper color
function updateMaskBackground(safeId, colorValue) {
    const [colorClass, hex] = colorValue.split('|');
    const wrapper = document.getElementById(`preview-wrapper-${safeId}`);
    if (wrapper) {
        wrapper.style.backgroundColor = hex;
    }
}


function updateIcon(id, cls, hex) {
    const safeId = id.replace(/[^a-zA-Z0-9-_]/g, '_');
    const preview = document.getElementById(`preview-${safeId}`);
    if (preview) preview.style.color = hex;
    
    const codeElement = document.getElementById(`code-${safeId}`);
    if (codeElement) {
        const raw = `<svg class="icon ${cls}">\n  <use href="${currentConfig.spriteUrl}#${id}"></use>\n</svg>`;
        
        // Remove existing highlighting classes before re-highlighting
        codeElement.className = '';
        codeElement.removeAttribute('data-highlighted');
        codeElement.textContent = raw; 
        codeElement.className = 'language-xml';
        
        // Re-apply syntax highlighting
        if (typeof hljs !== 'undefined') {
            hljs.highlightElement(codeElement);
        }
    }
}
    function updateMask(id, colorClass, hex, path) {
    const safeId = id.replace(/[^a-zA-Z0-9-_]/g, '_');
    const preview = document.getElementById(`preview-${safeId}`);
    const codeElement = document.getElementById(`code-${safeId}`);

    // Update the visual preview area
    if (preview) {
        preview.style.backgroundColor = hex;
    }

    // Update the code block with the correct CSS
    if (codeElement) {
        const cssCode = `.full-background {position: relative !important;overflow: hidden!important;z-index: 1!important;}     
.full-background::before {content: "" !important;position: absolute !important;top: 0!important;left: 0!important;width: 100%!important;height: 100%!important;background-color: ${hex}; /* ${colorClass} */opacity: 1; /* Adjust Transparency */-webkit-mask-image: url('https://assets.henryschein.com/${safeId}.svg')!important;mask-image: url('https://assets.henryschein.com/${safeId}.svg')!important;-webkit-mask-repeat: no-repeat!important;mask-repeat: no-repeat!important; -webkit-mask-position: center right!important; mask-position: center right!important; -webkit-mask-size: cover!important; mask-size: cover!important; z-index: -1!important;pointer-events: none!important;}
.full-background > .maincontent {position: relative;z-index: 2;}`;
        
        // Remove existing highlighting before re-highlighting
        codeElement.className = '';
        codeElement.removeAttribute('data-highlighted');
        codeElement.textContent = cssCode;
        codeElement.className = 'language-css';
        
        // Re-apply syntax highlighting
        if (typeof hljs !== 'undefined') {
            hljs.highlightElement(codeElement);
        }
    }
}

    function copyToClipboard(id, btn) {
        const el = document.getElementById(id);
        navigator.clipboard.writeText(el.innerText).then(() => {
            const old = btn.innerText;
            btn.innerText = "Copied!";
            setTimeout(() => btn.innerText = old, 1500);
        });
    }

    function downloadSVG(iconId, safeId) {
        if (!spriteText) return;
        const select = document.querySelector(`select[data-safe-id="${safeId}"]`);
        const [colorClass, colorHex] = select.value.split('|');
        const match = spriteText.match(new RegExp(`<symbol[^>]*id="${iconId}"[^>]*>(.*?)</symbol>`, 's'));
        if (!match) return;

        const viewBox = match[0].match(/viewBox="([^"]*)"/)?.[1] || '0 0 110 110';
        let content = match[1]
            .replace(/fill:\s*currentColor/g, `fill:${colorHex}`)
            .replace(/stroke:\s*currentColor/g, `stroke:${colorHex}`)
            .replace(/fill="currentColor"/g, `fill="${colorHex}"`)
            .replace(/stroke="currentColor"/g, `stroke="${colorHex}"`);

        const svgString = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ns0="http://www.w3.org/2000/svg" xmlns:ns1="http://www.w3.org/2000/svg" viewBox="${viewBox}" width="110" height="110">
${content}
</svg>`;

        const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${iconId}_${colorClass}.svg`;
        a.click();
        URL.revokeObjectURL(url);
    }

    // Ensure you have a way to download the raw SVG even if it's not in the sprite
function downloadMaskSVG(id, path) {
    fetch(path)
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${id}.svg`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        });
}


    function downloadPNG(iconId, safeId) {
    // 1. Get the color info from the color select
    const colorSelect = document.querySelector(`select[data-safe-id="${safeId}"]`);
    if (!colorSelect) return;
    const [colorClass, colorHex] = colorSelect.value.split('|');

    // 2. Get the size from the NEW size select
    const sizeSelect = document.getElementById(`size-${safeId}`);
    const size = parseInt(sizeSelect.value) || 512;

    const match = spriteText.match(new RegExp(`<symbol[^>]*id="${iconId}"[^>]*>(.*?)</symbol>`, 's'));
    if (!match) return;

    const viewBox = match[0].match(/viewBox="([^"]*)"/)?.[1] || '0 0 110 110';
    let cleanContent = match[1]
        .replace(/<(\/?)ns[0-9]+:/g, '<$1')
        .replace(/\s+ns[0-9]+:[a-z-]+="[^"]*"/gi, '')
        .replace(/sketch:type="[^"]*"/gi, '')
        .replace(/currentColor/g, colorHex);

    // Use the dynamic size for width and height
    const svgHeader = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="${viewBox}" width="${size}" height="${size}">${cleanContent}</svg>`;
    
    const canvas = document.createElement('canvas');
    canvas.width = size; 
    canvas.height = size;
    const ctx = canvas.getContext('2d');
    const img = new Image();

    img.onload = function() {
        ctx.clearRect(0, 0, size, size);
        ctx.drawImage(img, 0, 0, size, size);
        const a = document.createElement("a");
        a.href = canvas.toDataURL("image/png");
        a.download = `${iconId}_${size}px_${colorClass}.png`;
        a.click();
    };
    img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgHeader)));
}

    window.addEventListener('DOMContentLoaded', loadConfig);

    const backToTopButton = document.querySelector("#backToTop");

window.addEventListener("scroll", () => {
  if (window.pageYOffset > 300) {
    backToTopButton.classList.add("show");
  } else {
    backToTopButton.classList.remove("show");
  }
});

backToTopButton.addEventListener("click", () => {
  window.scrollTo(0, 0);
});
</script>

</body>

</html>